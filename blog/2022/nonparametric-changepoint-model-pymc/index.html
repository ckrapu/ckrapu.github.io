<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Modeling temporal data with an unknown number of changepoints | Christopher Krapu </title> <meta name="author" content="Christopher Krapu"> <meta name="description" content="A nonparametric changepoint model in PyMC"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%8C%81&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://ckrapu.github.io/blog/2022/nonparametric-changepoint-model-pymc/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Christopher</span> Krapu </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">posts </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link"> search <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Modeling temporal data with an unknown number of changepoints</h1> <p class="post-meta"> Created in November 20, 2022 </p> <p class="post-tags"> <a href="/blog/2022"> <i class="fa-solid fa-calendar fa-sm"></i> 2022 </a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Identifying structural breaks in data is an important problem to folks that frequently work with time series data. Some examples of how people have dealt with the problem of a single changepoint can be found <a href="https://cscherrer.github.io/post/bayesian-changepoint/" rel="external nofollow noopener" target="_blank">here</a> and <a href="https://mc-stan.org/docs/2_23/stan-users-guide/change-point-section.html" rel="external nofollow noopener" target="_blank">here</a>.</p> <p>Generally, the setup looks like this: we have some data \(X_t\) indexed by a discrete time coordinate \(t \in \{1,...,T\}\) and a parametric submodel linking the distribution of \(X\) to another quantity \(\mu_t\) which depends on the temporal coordinate. For the simple case of a linear Gaussian model with a single change point, we have</p> \[a_1, a_2 \sim N(0, \sigma^2_\mu)\] \[\tau \sim \text{DiscreteUniform}(\{1,...,T\})\] \[\mu_t = \left\{ \begin{array}{l} a_1 \text{ if } t &gt; \tau \\ a_2 \text{ if } t \le \tau \end{array} \right.\] \[X_t \sim N(\mu_t, \sigma_\epsilon)\] <p>with your scale priors of choice on the variance parameters \(\sigma_\epsilon\) and \(\sigma_\mu\). Now, one of the main conceptual problems with this model is that you need to assume it has a single changepoint. You can relax that assumption by extending this model to include more \(\tau\) and \(a\) parameters, but you’ll still need to specify the number of them ahead of time.</p> <p>Relaxing the assumption on the number of parameters is, for the most part, a solved problem in the research community (see <a href="https://www.sciencedirect.com/science/article/abs/pii/S0167715297000503" rel="external nofollow noopener" target="_blank">here</a> and <a href="https://repository.upenn.edu/cgi/viewcontent.cgi?article=1376&amp;context=statistics_papers" rel="external nofollow noopener" target="_blank">here</a> for a few representative examples). Unfortunately, these require the analyst to implement the inference techniques presented by hand; these are often Gibbs samplers or similar. Wouldn’t it be nice to just be able to use a PPL and write down the forward process instead?</p> <p>That’s the point of this notebook - we’ll walk through a construction of a changepoint model plus inference in PyMC which is considerably more straightforward than a handwritten sampler.</p> <p>We’ll start by simulating some data over 50 timesteps; there are 4 changepoints and the model’s likelihood is Gaussian. We will use a standard set of imports for working with PyMC and set the seed for repeatability.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">pymc</span> <span class="k">as</span> <span class="n">pm</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">aesara.tensor</span> <span class="k">as</span> <span class="n">at</span>
<span class="kn">from</span> <span class="n">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="n">IPython.display</span> <span class="kn">import</span> <span class="n">set_matplotlib_formats</span>
<span class="nf">set_matplotlib_formats</span><span class="p">(</span><span class="sh">'</span><span class="s">svg</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">pdf</span><span class="sh">'</span><span class="p">)</span>
<span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="mi">827</span><span class="p">)</span>
</code></pre></div></div> <h1 id="simulating-a-dataset">Simulating a dataset</h1> <p>Since the generative process for this data is simple, the code required to simulate data is relatively short. We begin by sampling the changepoints and then adding offsets for each changepoint to the mean value of the data. We then perturb this mean with normal noise variates to create simulated observations.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">T</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">noise_sd</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">n_changepoints</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">true_cp</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_changepoints</span><span class="p">))</span>
<span class="n">offsets_per_period</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="n">n_changepoints</span><span class="p">)</span>

<span class="n">noiseless</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">changepoint</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">true_cp</span><span class="p">,</span> <span class="n">offsets_per_period</span><span class="p">):</span>
  <span class="n">noiseless</span><span class="p">[</span><span class="n">start_time</span><span class="p">:</span><span class="n">changepoint</span><span class="p">]</span> <span class="o">+=</span> <span class="n">offset</span>
  <span class="n">start_time</span> <span class="o">=</span> <span class="n">changepoint</span>

<span class="n">xs</span> <span class="o">=</span> <span class="n">noiseless</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">noise_sd</span>
</code></pre></div></div> <p>As we can see below, the green changepoints do clearly correspond to changes in the level of the time series. However, not all of them are obvious - the last one, in particular, is a relatively small jump.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="sh">'</span><span class="s">o</span><span class="sh">'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">k</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Observed data</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">noiseless</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">g</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Noise-free mean value</span><span class="sh">'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cp</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">true_cp</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">label</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Change point</span><span class="sh">'</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">label</span><span class="o">=</span><span class="bp">None</span>
  <span class="n">plt</span><span class="p">.</span><span class="nf">axvline</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">g</span><span class="sh">'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">'</span><span class="s">--</span><span class="sh">'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Timestep</span><span class="sh">'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">$$X(t)$$</span><span class="sh">'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
</code></pre></div></div> <p><img src="/images/cp_data.svg" alt="svg"></p> <h1 id="creating-the-model">Creating the model</h1> <p>For inference, we’ll assume that we don’t know the number of changepoints. The main trick that we’ll use is to instantiate way more changepoints than we need, and use latent variables to zero out most of them.</p> <p>The model that we declare looks like the following: \(p_{changepoint} \sim \text{Beta}(2,8)\)</p> \[\tau_1,...,\tau_{M} \sim \text{DiscreteUniform}(\{1,...,T\})\] \[u_1,...,u_M \sim \text{Bernoulli}(p_{changepoint})\] \[\mu \sim \text{Normal}(0, 1)\] \[\sigma^2_{\delta} \sim \text{HalfNormal}(2)\] \[\sigma^2_{\epsilon} \sim \text{HalfNormal}(1)\] \[\delta_1,...,\delta_M \sim \text{Normal}(0, \sigma^2_{\delta})\] <p>For convenience in our notation, we assume that \(\tau_1,...,\tau_M\) are ordered. We perform an elementwise multiplication of the \(\delta\) offsets with the latent binary variables \(u_m\) as well as indicator variables \(I\) \(\mu_t\):</p> \[\mu_t = \left[\left( \begin{array}{ccc} I(t\ge \tau_1) \\ \vdots \\ I(t\ge \tau_M) \end{array} \right) \odot \left( \begin{array}{ccc} \delta_1 \\ \vdots \\ \delta_M \end{array} \right)\right] \left(\begin{array}{ccc} u_1 \cdots u_M \end{array}\right)\] \[X_t \sim N(\mu_t, \sigma^2_\epsilon)\] <p>Since \(p_{changepoint}\) has a prior encouraging it to be lower, the indicator variables above will be pushed towards zero, thereby deactivating some of the \(\delta\) terms’ contributions towards \(X\).</p> <p>The code block below implements this model logic, though it uses <code class="language-plaintext highlighter-rouge">uniform_except_ends</code> to prevent any \(\tau\) values from occurring in the first two or last two timesteps.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">max_cp_inference</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">tiled_times</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="n">T</span><span class="p">)[:,</span> <span class="bp">None</span><span class="p">].</span><span class="nf">repeat</span><span class="p">(</span><span class="n">max_cp_inference</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># We do this so that we can allow the Categorical prior over the changepoint
# locations to exclude the timesteps at the very beginning and very end. 
# The reason for this is that these data points always benefit from using an 
# extra changepoint just for the first or last data points. 
</span><span class="n">uniform_except_ends</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">ones</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">uniform_except_ends</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">uniform_except_ends</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">uniform_except_ends</span> <span class="o">=</span> <span class="n">uniform_except_ends</span> <span class="o">/</span> <span class="n">uniform_except_ends</span><span class="p">.</span><span class="nf">sum</span><span class="p">()</span>

<span class="k">with</span> <span class="n">pm</span><span class="p">.</span><span class="nc">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
  <span class="c1"># Probability that any of the &lt;max_cp_inference&gt; change points are active
</span>  <span class="n">p_changepoint</span>  <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="nc">Beta</span><span class="p">(</span><span class="sh">'</span><span class="s">p_changepoint</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

  <span class="c1"># Sort the changepoints for faster mixing / convergence
</span>  <span class="n">changepoints</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="nc">Categorical</span><span class="p">(</span><span class="sh">'</span><span class="s">changepoints</span><span class="sh">'</span><span class="p">,</span> <span class="n">uniform_except_ends</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">max_cp_inference</span><span class="p">)</span>
  <span class="n">is_cp_active</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="nc">Bernoulli</span><span class="p">(</span><span class="sh">'</span><span class="s">is_cp_active</span><span class="sh">'</span><span class="p">,</span> <span class="n">p_changepoint</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">max_cp_inference</span><span class="p">)</span>

  <span class="n">changepoints_sorted</span> <span class="o">=</span> <span class="n">at</span><span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="n">changepoints</span><span class="p">)</span>

  <span class="c1"># This will give us a nice posterior estimate of the number of changepoints
</span>  <span class="n">num_active_cp</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="nc">Deterministic</span><span class="p">(</span><span class="sh">'</span><span class="s">num_active_cp</span><span class="sh">'</span><span class="p">,</span> <span class="n">pm</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">is_cp_active</span><span class="p">))</span>

  <span class="n">global_mean</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="nc">Normal</span><span class="p">(</span><span class="sh">'</span><span class="s">global_mean</span><span class="sh">'</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">cp_sd</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="nc">HalfNormal</span><span class="p">(</span><span class="sh">'</span><span class="s">cp_sd</span><span class="sh">'</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">noise_sd</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="nc">HalfNormal</span><span class="p">(</span><span class="sh">'</span><span class="s">noise_sd</span><span class="sh">'</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">changepoint_deltas</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="nc">Normal</span><span class="p">(</span><span class="sh">'</span><span class="s">changepoint_deltas</span><span class="sh">'</span><span class="p">,</span> <span class="n">cp_sd</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">max_cp_inference</span><span class="p">)</span>

  <span class="c1"># Operation involves operations on arrays with shape (T, max_cp_inference)
</span>  <span class="c1"># Elementwise operation zeros-out contributions from changepoints which are
</span>  <span class="c1"># not active
</span>  <span class="n">is_timestep_past_cp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tiled_times</span> <span class="o">&gt;</span> <span class="n">changepoints</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="p">:].</span><span class="nf">repeat</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
  <span class="n">active_deltas</span> <span class="o">=</span> <span class="p">(</span><span class="n">changepoint_deltas</span><span class="o">*</span><span class="n">is_cp_active</span><span class="p">)</span>
  <span class="n">cp_contrib</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="nc">Deterministic</span><span class="p">(</span><span class="sh">'</span><span class="s">cp_contrib</span><span class="sh">'</span><span class="p">,</span>
                                <span class="n">global_mean</span> <span class="o">+</span> <span class="n">pm</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">is_timestep_past_cp</span> <span class="o">*</span> <span class="n">active_deltas</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">)</span>

  <span class="n">_</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="nc">Normal</span><span class="p">(</span><span class="sh">'</span><span class="s">likelihood</span><span class="sh">'</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">cp_contrib</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">noise_sd</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">xs</span><span class="p">)</span>

  <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="n">draws</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

</code></pre></div></div> <style>progress{border:0;background-size:auto}progress:not([value]),progress:not([value])::-webkit-progress-bar{background:repeating-linear-gradient(45deg,#7e7e7e,#7e7e7e 10px,#5c5c5c 10px,#5c5c5c 20px)}.progress-bar-interrupted,.progress-bar-interrupted::-webkit-progress-bar{background:#f44336}</style> <div> <progress value="16000" class="" max="16000" style="width:300px; height:20px; vertical-align: middle;"></progress> 100.00% [16000/16000 02:30&lt;00:00 Sampling chain 0, 6,594 divergences] </div> <style>progress{border:0;background-size:auto}progress:not([value]),progress:not([value])::-webkit-progress-bar{background:repeating-linear-gradient(45deg,#7e7e7e,#7e7e7e 10px,#5c5c5c 10px,#5c5c5c 20px)}.progress-bar-interrupted,.progress-bar-interrupted::-webkit-progress-bar{background:#f44336}</style> <div> <progress value="16000" class="" max="16000" style="width:300px; height:20px; vertical-align: middle;"></progress> 100.00% [16000/16000 03:03&lt;00:00 Sampling chain 1, 3,278 divergences] </div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERROR:pymc:There were 6594 divergences after tuning. Increase `target_accept` or reparameterize.
WARNING:pymc:The acceptance probability does not match the target. It is 0.08247, but should be close to 0.8. Try to increase the number of tuning steps.
ERROR:pymc:There were 9872 divergences after tuning. Increase `target_accept` or reparameterize.
WARNING:pymc:The acceptance probability does not match the target. It is 0.5083, but should be close to 0.8. Try to increase the number of tuning steps.
</code></pre></div></div> <p>From a sampling perspective, this is a pretty ugly problem. NUTS isn’t designed to work well in an alternating NUTS / Gibbs sampling scheme, and we get tons of divergences because NUTS is facing a log-posterior landscape that is shifting dramatically on every iteration because of the discrete latent variables.</p> <p>That said, the \(\hat{R}\) values look good - no warnings are fired off!</p> <h1 id="assessing-the-results-from-inference">Assessing the results from inference</h1> <p>As a basic statistic for the number of changepoints, we can just take the posterior mean of the indicator variables’ sum to see how many parameters were active, on average.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="sh">'</span><span class="s">num_active_cp</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span>
</code></pre></div></div> <div> <svg style="position: absolute; width: 0; height: 0; overflow: hidden"> <defs> <symbol id="icon-database" viewbox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewbox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs> </svg> <style>:root{--xr-font-color0:var(--jp-content-font-color0,rgba(0,0,0,1));--xr-font-color2:var(--jp-content-font-color2,rgba(0,0,0,0.54));--xr-font-color3:var(--jp-content-font-color3,rgba(0,0,0,0.38));--xr-border-color:var(--jp-border-color2,#e0e0e0);--xr-disabled-color:var(--jp-layout-color3,#bdbdbd);--xr-background-color:var(--jp-layout-color0,white);--xr-background-color-row-even:var(--jp-layout-color1,white);--xr-background-color-row-odd:var(--jp-layout-color2,#eee)}html[theme=dark],body.vscode-dark{--xr-font-color0:rgba(255,255,255,1);--xr-font-color2:rgba(255,255,255,0.54);--xr-font-color3:rgba(255,255,255,0.38);--xr-border-color:#1f1f1f;--xr-disabled-color:#515151;--xr-background-color:#111;--xr-background-color-row-even:#111;--xr-background-color-row-odd:#313131}.xr-wrap{display:block!important;min-width:300px;max-width:700px}.xr-text-repr-fallback{display:none}.xr-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px var(--xr-border-color)}.xr-header>div,.xr-header>ul{display:inline;margin-top:0;margin-bottom:0}.xr-obj-type,.xr-array-name{margin-left:2px;margin-right:10px}.xr-obj-type{color:var(--xr-font-color2)}.xr-sections{padding-left:0!important;display:grid;grid-template-columns:150px auto auto 1fr 20px 20px}.xr-section-item{display:contents}.xr-section-item input{display:none}.xr-section-item input+label{color:var(--xr-disabled-color)}.xr-section-item input:enabled+label{cursor:pointer;color:var(--xr-font-color2)}.xr-section-item input:enabled+label:hover{color:var(--xr-font-color0)}.xr-section-summary{grid-column:1;color:var(--xr-font-color2);font-weight:500}.xr-section-summary>span{display:inline-block;padding-left:.5em}.xr-section-summary-in:disabled+label{color:var(--xr-font-color2)}.xr-section-summary-in+label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center}.xr-section-summary-in:disabled+label:before{color:var(--xr-disabled-color)}.xr-section-summary-in:checked+label:before{content:'▼'}.xr-section-summary-in:checked+label>span{display:none}.xr-section-summary,.xr-section-inline-details{padding-top:4px;padding-bottom:4px}.xr-section-inline-details{grid-column:2 / -1}.xr-section-details{display:none;grid-column:1 / -1;margin-bottom:5px}.xr-section-summary-in:checked ~ .xr-section-details{display:contents}.xr-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto}.xr-array-wrap>label{grid-column:1;vertical-align:top}.xr-preview{color:var(--xr-font-color3)}.xr-array-preview,.xr-array-data{padding:0 5px!important;grid-column:2}.xr-array-data,.xr-array-in:checked ~ .xr-array-preview{display:none}.xr-array-in:checked ~ .xr-array-data,.xr-array-preview{display:inline-block}.xr-dim-list{display:inline-block!important;list-style:none;padding:0!important;margin:0}.xr-dim-list li{display:inline-block;padding:0;margin:0}.xr-dim-list:before{content:'('}.xr-dim-list:after{content:')'}.xr-dim-list li:not(:last-child):after{content:',';padding-right:5px}.xr-has-index{font-weight:bold}.xr-var-list,.xr-var-item{display:contents}.xr-var-item>div,.xr-var-item label,.xr-var-item>.xr-var-name span{background-color:var(--xr-background-color-row-even);margin-bottom:0}.xr-var-item>.xr-var-name:hover span{padding-right:5px}.xr-var-list>li:nth-child(odd)>div,.xr-var-list>li:nth-child(odd)>label,.xr-var-list>li:nth-child(odd)>.xr-var-name span{background-color:var(--xr-background-color-row-odd)}.xr-var-name{grid-column:1}.xr-var-dims{grid-column:2}.xr-var-dtype{grid-column:3;text-align:right;color:var(--xr-font-color2)}.xr-var-preview{grid-column:4}.xr-var-name,.xr-var-dims,.xr-var-dtype,.xr-preview,.xr-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px}.xr-var-name:hover,.xr-var-dims:hover,.xr-var-dtype:hover,.xr-attrs dt:hover{overflow:visible;width:auto;z-index:1}.xr-var-attrs,.xr-var-data{display:none;background-color:var(--xr-background-color)!important;padding-bottom:5px!important}.xr-var-attrs-in:checked ~ .xr-var-attrs,.xr-var-data-in:checked ~ .xr-var-data{display:block}.xr-var-data>table{float:right}.xr-var-name span,.xr-var-data,.xr-attrs{padding-left:25px!important}.xr-attrs,.xr-var-attrs,.xr-var-data{grid-column:1 / -1}dl.xr-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto}.xr-attrs dt,.xr-attrs dd{padding:0;margin:0;float:left;padding-right:10px;width:auto}.xr-attrs dt{font-weight:normal;grid-column:1}.xr-attrs dt:hover span{display:inline-block;background:var(--xr-background-color);padding-right:10px}.xr-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all}.xr-icon-database,.xr-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em!important;stroke-width:0;stroke:currentColor;fill:currentColor}</style> <pre class="xr-text-repr-fallback">&lt;xarray.DataArray 'num_active_cp' ()&gt;
array(3.2660625)</pre> <div class="xr-wrap" style="display:none"> <div class="xr-header"> <div class="xr-obj-type">xarray.DataArray</div> <div class="xr-array-name">'num_active_cp'</div> </div> <ul class="xr-sections"> <li class="xr-section-item"><div class="xr-array-wrap"> <input id="section-66376803-d2ba-411c-ba76-1595bd10deff" class="xr-array-in" type="checkbox" checked><label for="section-66376803-d2ba-411c-ba76-1595bd10deff" title="Show/hide data repr"><svg class="icon xr-icon-database"><use xlink:href="#icon-database"></use></svg></label><div class="xr-array-preview xr-preview"><span>3.266</span></div> <div class="xr-array-data"><pre>array(3.2660625)</pre></div> </div></li> <li class="xr-section-item"> <input id="section-b11f32d2-7f05-4c59-92c9-35b91eea8d9e" class="xr-section-summary-in" type="checkbox" disabled><label for="section-b11f32d2-7f05-4c59-92c9-35b91eea8d9e" class="xr-section-summary" title="Expand/collapse section">Coordinates: <span>(0)</span></label><div class="xr-section-inline-details"></div> <div class="xr-section-details"><ul class="xr-var-list"></ul></div> </li> <li class="xr-section-item"> <input id="section-7ea59420-61bc-4db6-b96c-ab2986f71ecb" class="xr-section-summary-in" type="checkbox" disabled><label for="section-7ea59420-61bc-4db6-b96c-ab2986f71ecb" class="xr-section-summary" title="Expand/collapse section">Attributes: <span>(0)</span></label><div class="xr-section-inline-details"></div> <div class="xr-section-details"><dl class="xr-attrs"></dl></div> </li> </ul> </div> </div> <p>We can also make a plot of the posterior inferences about the location and parameters of each changepoint as compared against the true values:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">top_10_cp</span> <span class="o">=</span> <span class="nc">Counter</span><span class="p">(</span>
    <span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="sh">'</span><span class="s">changepoints</span><span class="sh">'</span><span class="p">].</span><span class="nf">to_numpy</span><span class="p">().</span><span class="nf">ravel</span><span class="p">().</span><span class="nf">tolist</span><span class="p">()</span>
    <span class="p">).</span><span class="nf">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">noiseless</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">True noiseless values</span><span class="sh">'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="sh">'</span><span class="s">cp_contrib</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Inferred noiseless mean</span><span class="sh">'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">orange</span><span class="sh">'</span><span class="p">)</span>

<span class="n">q10</span><span class="p">,</span> <span class="n">q90</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">percentile</span><span class="p">(</span><span class="n">trace</span><span class="p">.</span><span class="n">posterior</span><span class="p">[</span><span class="sh">'</span><span class="s">cp_contrib</span><span class="sh">'</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">90</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">fill_between</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">q10</span><span class="p">,</span> <span class="n">q90</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">orange</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">''</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">k</span><span class="sh">'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="sh">'</span><span class="s">o</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Observed data</span><span class="sh">'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cp</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">true_cp</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">label</span> <span class="o">=</span> <span class="sh">'</span><span class="s">True change point</span><span class="sh">'</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">label</span><span class="o">=</span><span class="bp">None</span>
  <span class="n">plt</span><span class="p">.</span><span class="nf">axvline</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">g</span><span class="sh">'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">'</span><span class="s">--</span><span class="sh">'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">top_10_cp</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">label</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Inferred change point</span><span class="sh">'</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">label</span><span class="o">=</span><span class="bp">None</span>
  <span class="n">plt</span><span class="p">.</span><span class="nf">axvline</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">orange</span><span class="sh">'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">'</span><span class="s">--</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Timestep</span><span class="sh">'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">$$X(t)$$</span><span class="sh">'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="sh">'</span><span class="s">upper right</span><span class="sh">'</span><span class="p">);</span>
</code></pre></div></div> <p><img src="/images/cp_inference.svg" alt="svg"></p> <p>Here, the green vertical lines are the true changepoints while the orange vertical lines are one of the top 10 most likely changepoints as gleaned from the posterior samples. We can see that the major jumps around timesteps 10 and 20 are clearly captured, while there is more uncertainty from timesteps 20-40. The smaller jump at timestep 45 is also missed completely; this is not very surprising given how small it was.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/clustering-for-prob-preterm-birth/">Modeling spatial structure in binary data with an H3 hexagonal coordinate system</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/creating-an-emulator-for-an-agent-based-model/">Surrogate modeling for SEIR dynamics</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/density-estimation-for-geospatial-imagery-using-autoregressive-models/">Density estimation for geospatial imagery using autoregressive neural models</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/why-dont-we-just-freeze-the-carbon/">Solving climate change by abusing thermodynamic scaling laws</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/multivariate-sample-size-for-markov-chains/">Multivariate sample size for Markov chains</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Christopher Krapu. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js" integrity="sha256-YyRhy+F3bG+zvvwsW1E/uy5s5pKXwmG/bOPlV+1pt6o=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?601a2d3465e2a52bec38b600518d5f70"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let theme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===theme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=document.querySelector(".navbar-collapse");e.classList.contains("show")&&e.classList.remove("show"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-posts",title:"posts",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"post-solving-climate-change-by-abusing-thermodynamic-scaling-laws",title:"Solving climate change by abusing thermodynamic scaling laws",description:"A wintertime climate change solution",section:"Posts",handler:()=>{window.location.href="/blog/2024/why-dont-we-just-freeze-the-carbon/"}},{id:"post-modeling-temporal-data-with-an-unknown-number-of-changepoints",title:"Modeling temporal data with an unknown number of changepoints",description:"A nonparametric changepoint model in PyMC",section:"Posts",handler:()=>{window.location.href="/blog/2022/nonparametric-changepoint-model-pymc/"}},{id:"post-distributed-zonal-averages-for-fast-geospatial-analyses",title:"Distributed zonal averages for fast geospatial analyses",description:"Easy local average with Google Earth Engine&#39;s Python API",section:"Posts",handler:()=>{window.location.href="/blog/2022/fast-local-summary-earth-engine/"}},{id:"post-fast-kronecker-matrix-vector-product-with-einsum",title:"Fast Kronecker matrix-vector product with einsum",description:"Easy local average with Google Earth Engine&#39;s Python API",section:"Posts",handler:()=>{window.location.href="/blog/2021/fast-matrix-vector-product-for-structured-matrices/"}},{id:"post-balanced-spatial-partitioning-for-point-data-in-20-lines",title:"Balanced spatial partitioning for point data in 20 lines",description:"Recursively splitting by boxes",section:"Posts",handler:()=>{window.location.href="/blog/2021/balanced-spatial-partitioning-for-point-data-in-20-lines/"}},{id:"post-modeling-spatial-structure-in-binary-data-with-an-h3-hexagonal-coordinate-system",title:"Modeling spatial structure in binary data with an H3 hexagonal coordinate system",description:"Conditional autoregression for 6-adjacent data",section:"Posts",handler:()=>{window.location.href="/blog/2021/clustering-for-prob-preterm-birth/"}},{id:"post-surrogate-modeling-for-seir-dynamics",title:"Surrogate modeling for SEIR dynamics",description:"Modeling a model, for epidemiology",section:"Posts",handler:()=>{window.location.href="/blog/2021/creating-an-emulator-for-an-agent-based-model/"}},{id:"post-density-estimation-for-geospatial-imagery-using-autoregressive-neural-models",title:"Density estimation for geospatial imagery using autoregressive neural models",description:"Conditional autoregression for 6-adjacent data",section:"Posts",handler:()=>{window.location.href="/blog/2020/density-estimation-for-geospatial-imagery-using-autoregressive-models/"}},{id:"post-multivariate-sample-size-for-markov-chains",title:"Multivariate sample size for Markov chains",description:"Assessing effective sample size for multiple variates",section:"Posts",handler:()=>{window.location.href="/blog/2020/multivariate-sample-size-for-markov-chains/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%63%6B%72%61%70%75@%67%6D%61%69%6C.%63%6F%6D","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/ckrapu","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> </body> </html>